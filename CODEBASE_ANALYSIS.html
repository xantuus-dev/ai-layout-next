<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xantuus AI - Codebase Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2563eb;
            border-bottom: 3px solid #2563eb;
            padding-bottom: 10px;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        h2 {
            color: #1e40af;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
            font-size: 1.8em;
        }
        
        h3 {
            color: #3b82f6;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #60a5fa;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        p {
            margin-bottom: 15px;
            color: #4b5563;
        }
        
        ul, ol {
            margin-left: 30px;
            margin-bottom: 20px;
            color: #4b5563;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            color: #dc2626;
        }
        
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }
        
        .badge-success {
            background: #10b981;
            color: white;
        }
        
        .badge-info {
            background: #3b82f6;
            color: white;
        }
        
        .badge-warning {
            background: #f59e0b;
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        
        th {
            background: #2563eb;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        tr:hover {
            background: #f9fafb;
        }
        
        .highlight {
            background: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .toc {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }
        
        .toc h3 {
            margin-top: 0;
            color: #1e40af;
        }
        
        .toc ul {
            list-style: none;
            margin-left: 0;
        }
        
        .toc a {
            color: #2563eb;
            text-decoration: none;
            display: block;
            padding: 5px 0;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: #f9fafb;
            padding: 20px;
            border-radius: 6px;
            border-left: 4px solid #2563eb;
        }
        
        .feature-card h4 {
            margin-top: 0;
            color: #1e40af;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            flex: 1;
            min-width: 200px;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Xantuus AI - Codebase Analysis</h1>
        
        <div class="toc">
            <h3>üìë Table of Contents</h3>
            <ul>
                <li><a href="#summary">Executive Summary</a></li>
                <li><a href="#architecture">Architecture Overview</a></li>
                <li><a href="#features">Core Features</a></li>
                <li><a href="#database">Database Schema</a></li>
                <li><a href="#components">Key Components</a></li>
                <li><a href="#api">API Endpoints</a></li>
                <li><a href="#security">Security Features</a></li>
                <li><a href="#credits">Credit System</a></li>
                <li><a href="#deployment">Deployment</a></li>
                <li><a href="#quality">Code Quality</a></li>
            </ul>
        </div>

        <div class="section" id="summary">
            <h2>üìä Executive Summary</h2>
            <p><strong>Xantuus AI</strong> is a comprehensive, production-ready SaaS platform built with Next.js 14 that provides AI-powered automation, chat interfaces, and autonomous agent capabilities. The platform features a complete billing system, multi-provider AI integration, workspace management, and sophisticated agent execution capabilities.</p>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-number">19</div>
                    <div class="stat-label">Database Models</div>
                </div>
                <div class="stat">
                    <div class="stat-number">3</div>
                    <div class="stat-label">AI Providers</div>
                </div>
                <div class="stat">
                    <div class="stat-number">3</div>
                    <div class="stat-label">Pricing Tiers</div>
                </div>
                <div class="stat">
                    <div class="stat-number">6+</div>
                    <div class="stat-label">Agent Tools</div>
                </div>
            </div>
        </div>

        <div class="section" id="architecture">
            <h2>üèóÔ∏è Architecture Overview</h2>
            
            <h3>Technology Stack</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Frontend</h4>
                    <ul>
                        <li>Next.js 14 (App Router)</li>
                        <li>TypeScript</li>
                        <li>React 18</li>
                        <li>Tailwind CSS + shadcn/ui</li>
                        <li>Zustand (state)</li>
                        <li>Recharts (analytics)</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>Backend</h4>
                    <ul>
                        <li>Next.js API Routes</li>
                        <li>NextAuth.js</li>
                        <li>Prisma ORM</li>
                        <li>PostgreSQL (Supabase)</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>AI & Integrations</h4>
                    <ul>
                        <li>Multi-provider AI router</li>
                        <li>Puppeteer (browser)</li>
                        <li>Google APIs</li>
                        <li>Stripe + RevenueCat</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section" id="features">
            <h2>‚ú® Core Features</h2>
            
            <h3>1. Authentication System</h3>
            <ul>
                <li><strong>OAuth Providers:</strong> Google, Microsoft Azure AD, Apple</li>
                <li><strong>Session Management:</strong> Database-backed sessions</li>
                <li><strong>Security:</strong> Cloudflare Turnstile bot protection</li>
                <li><strong>Files:</strong> <code>src/lib/auth.ts</code>, <code>src/app/api/auth/[...nextauth]/route.ts</code></li>
            </ul>
            
            <h3>2. Billing & Subscriptions</h3>
            <table>
                <thead>
                    <tr>
                        <th>Plan</th>
                        <th>Price</th>
                        <th>Credits/Month</th>
                        <th>Features</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Free</strong></td>
                        <td>$0</td>
                        <td>4,000</td>
                        <td>Basic features, 20 concurrent tasks</td>
                    </tr>
                    <tr>
                        <td><strong>Pro</strong></td>
                        <td>$29/mo</td>
                        <td>12,000</td>
                        <td>All features, priority support</td>
                    </tr>
                    <tr>
                        <td><strong>Enterprise</strong></td>
                        <td>$199/mo</td>
                        <td>40,000</td>
                        <td>Everything + SLA, custom fine-tuning</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>3. AI Chat Interface</h3>
            <ul>
                <li>Multi-model support (Claude, OpenAI, Google Gemini)</li>
                <li>File upload support (images as base64)</li>
                <li>Extended thinking mode</li>
                <li>Token-based credit tracking</li>
                <li>Rate limiting & API key authentication</li>
            </ul>
            
            <h3>4. Autonomous Agent System</h3>
            <p><strong>Architecture:</strong> ReAct (Reasoning + Acting) loop pattern</p>
            <ul>
                <li><strong>Planning:</strong> AI creates execution plan</li>
                <li><strong>Execution:</strong> Multi-step tool-based actions</li>
                <li><strong>Tracking:</strong> Full execution trace</li>
                <li><strong>Tools:</strong> Browser, Email, Calendar, Drive, HTTP, AI reasoning</li>
            </ul>
            
            <h3>5. Workspace Management</h3>
            <ul>
                <li>Projects and tasks organization</li>
                <li>Conversations with message history</li>
                <li>Workspace collaboration (future)</li>
            </ul>
            
            <h3>6. Template System</h3>
            <ul>
                <li>Pre-built prompts with variable substitution</li>
                <li>Categories, tags, and tier-based access</li>
                <li>Integration requirements tracking</li>
                <li>Usage analytics</li>
            </ul>
        </div>

        <div class="section" id="database">
            <h2>üóÑÔ∏è Database Schema</h2>
            
            <h3>Core Tables (19 total)</h3>
            
            <h4>Authentication</h4>
            <ul>
                <li><code>User</code> - User accounts with subscription info</li>
                <li><code>Account</code> - OAuth provider accounts</li>
                <li><code>Session</code> - Active user sessions</li>
                <li><code>VerificationToken</code> - Email verification</li>
            </ul>
            
            <h4>Billing & Usage</h4>
            <ul>
                <li><code>UsageRecord</code> - API usage tracking</li>
                <li><code>WebhookEvent</code> - Idempotency for webhooks</li>
                <li><code>ApiKey</code> - User API keys</li>
            </ul>
            
            <h4>Workspace</h4>
            <ul>
                <li><code>Workspace</code> - User workspaces</li>
                <li><code>Project</code> - Projects within workspaces</li>
                <li><code>Task</code> - Agent tasks with execution state</li>
                <li><code>TaskExecution</code> - Detailed execution logs</li>
                <li><code>Conversation</code> - Chat conversations</li>
                <li><code>Message</code> - Individual messages</li>
                <li><code>MessageAttachment</code> - File attachments</li>
            </ul>
            
            <h4>Templates</h4>
            <ul>
                <li><code>PromptTemplate</code> - Prompt templates</li>
                <li><code>PromptTemplateCategory</code> - Template categories</li>
            </ul>
            
            <h3>Key Relationships</h3>
            <pre><code>User ‚Üí Workspaces ‚Üí Projects ‚Üí Tasks
User ‚Üí Conversations ‚Üí Messages
User ‚Üí UsageRecords (for analytics)
Task ‚Üí TaskExecution (detailed logs)</code></pre>
        </div>

        <div class="section" id="components">
            <h2>üîß Key Components</h2>
            
            <h3>1. AI Provider Router</h3>
            <p><strong>File:</strong> <code>src/lib/ai-providers/router.ts</code></p>
            <ul>
                <li>Unified interface for multiple AI providers</li>
                <li>Automatic provider selection by model ID</li>
                <li>Credit estimation per model</li>
                <li>Model capability filtering</li>
            </ul>
            
            <h3>2. Agent Executor</h3>
            <p><strong>File:</strong> <code>src/lib/agent/executor.ts</code></p>
            <p><strong>Pattern:</strong> ReAct (Reasoning + Acting)</p>
            <ol>
                <li><strong>Plan:</strong> AI creates execution plan</li>
                <li><strong>Execute:</strong> For each step:
                    <ul>
                        <li>Reason (AI explains action)</li>
                        <li>Act (execute tool)</li>
                        <li>Observe (process result)</li>
                    </ul>
                </li>
                <li><strong>Track:</strong> Record execution trace</li>
            </ol>
            
            <h3>3. Browser Control</h3>
            <p><strong>File:</strong> <code>src/lib/browser-control.ts</code></p>
            <p><strong>Security Features:</strong></p>
            <ul>
                <li>Sandboxing and process isolation</li>
                <li>Resource limits (time, memory)</li>
                <li>Content filtering (XSS, prompt injection)</li>
                <li>Domain blocking (metadata endpoints)</li>
                <li>Rate limiting per user</li>
            </ul>
            
            <h3>4. Tool Registry</h3>
            <p><strong>Location:</strong> <code>src/lib/agent/tools/</code></p>
            <p><strong>Available Tools:</strong></p>
            <ul>
                <li><code>browser.ts</code> - Web automation</li>
                <li><code>email.ts</code> - Gmail integration</li>
                <li><code>calendar.ts</code> - Google Calendar</li>
                <li><code>drive.ts</code> - Google Drive</li>
                <li><code>http.ts</code> - HTTP requests</li>
                <li><code>ai.ts</code> - AI reasoning</li>
            </ul>
        </div>

        <div class="section" id="api">
            <h2>üåê API Endpoints</h2>
            
            <h3>Authentication</h3>
            <ul>
                <li><code>POST /api/auth/[...nextauth]</code> - NextAuth handler</li>
            </ul>
            
            <h3>Chat & AI</h3>
            <ul>
                <li><code>POST /api/chat</code> - AI chat with usage tracking</li>
                <li><code>POST /api/agent/execute</code> - Execute agent task</li>
                <li><code>GET /api/agent/status/[taskId]</code> - Get task status</li>
            </ul>
            
            <h3>Billing</h3>
            <ul>
                <li><code>POST /api/stripe/checkout</code> - Create subscription</li>
                <li><code>POST /api/stripe/webhook</code> - Handle Stripe events</li>
                <li><code>GET /api/stripe/portal</code> - Billing portal session</li>
            </ul>
            
            <h3>Workspace</h3>
            <ul>
                <li><code>GET/POST /api/workspace/conversations</code> - Manage conversations</li>
                <li><code>GET/POST /api/workspace/projects</code> - Manage projects</li>
                <li><code>GET/POST /api/workspace/tasks</code> - Manage tasks</li>
            </ul>
            
            <h3>Templates</h3>
            <ul>
                <li><code>GET /api/templates</code> - List templates</li>
                <li><code>GET /api/templates/[id]</code> - Get template</li>
                <li><code>POST /api/admin/templates</code> - Create template (admin)</li>
            </ul>
        </div>

        <div class="section" id="security">
            <h2>üîí Security Features</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Authentication</h4>
                    <ul>
                        <li>OAuth (no password storage)</li>
                        <li>Database-backed sessions</li>
                        <li>API key authentication</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>Rate Limiting</h4>
                    <ul>
                        <li>Per-user rate limits</li>
                        <li>API endpoint protection</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>Browser Security</h4>
                    <ul>
                        <li>Sandboxing</li>
                        <li>Domain blocking</li>
                        <li>Content filtering</li>
                        <li>Resource limits</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>Input Validation</h4>
                    <ul>
                        <li>Parameter validation</li>
                        <li>Credit enforcement</li>
                        <li>Webhook signature verification</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section" id="credits">
            <h2>üí∞ Credit System</h2>
            
            <h3>Credit Calculation</h3>
            <ul>
                <li><strong>Model-Based:</strong> Different models have different credit costs</li>
                <li><strong>Token-Based:</strong> Credits calculated from token usage</li>
                <li><strong>Formula:</strong> <code>credits = (tokens / 1000) * creditsPerThousandTokens</code></li>
            </ul>
            
            <h3>Credit Allocation by Plan</h3>
            <table>
                <thead>
                    <tr>
                        <th>Plan</th>
                        <th>Credits/Month</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Free</td>
                        <td>4,000</td>
                    </tr>
                    <tr>
                        <td>Pro</td>
                        <td>12,000</td>
                    </tr>
                    <tr>
                        <td>Enterprise</td>
                        <td>40,000</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" id="deployment">
            <h2>üöÄ Deployment</h2>
            
            <h3>Required Environment Variables</h3>
            <h4>Minimum:</h4>
            <ul>
                <li><code>DATABASE_URL</code> - PostgreSQL connection string</li>
                <li><code>NEXTAUTH_SECRET</code> - Session encryption key</li>
                <li><code>NEXTAUTH_URL</code> - Application URL</li>
                <li><code>GOOGLE_CLIENT_ID</code> / <code>GOOGLE_CLIENT_SECRET</code> - OAuth</li>
                <li><code>ANTHROPIC_API_KEY</code> - AI provider</li>
            </ul>
            
            <h4>Optional:</h4>
            <ul>
                <li><code>STRIPE_SECRET_KEY</code> - Payment processing</li>
                <li><code>OPENAI_API_KEY</code> - Additional AI provider</li>
                <li><code>GOOGLE_AI_API_KEY</code> - Google Gemini</li>
                <li><code>NEXT_PUBLIC_TURNSTILE_SITE_KEY</code> - Bot protection</li>
            </ul>
        </div>

        <div class="section" id="quality">
            <h2>üìà Code Quality & Architecture</h2>
            
            <h3>Strengths</h3>
            <ul>
                <li><span class="badge badge-success">‚úì</span> Full TypeScript coverage</li>
                <li><span class="badge badge-success">‚úì</span> Clear separation of concerns</li>
                <li><span class="badge badge-success">‚úì</span> Database-first design</li>
                <li><span class="badge badge-success">‚úì</span> Multiple security layers</li>
                <li><span class="badge badge-success">‚úì</span> Serverless architecture</li>
                <li><span class="badge badge-success">‚úì</span> Well-documented</li>
            </ul>
            
            <h3>Areas for Improvement</h3>
            <ul>
                <li><span class="badge badge-warning">!</span> Add comprehensive test coverage</li>
                <li><span class="badge badge-warning">!</span> Implement proper job queue for agents</li>
                <li><span class="badge badge-warning">!</span> Add monitoring/observability</li>
                <li><span class="badge badge-warning">!</span> Implement caching layer</li>
                <li><span class="badge badge-warning">!</span> Add E2E tests</li>
            </ul>
        </div>

        <div class="section">
            <h2>üìù Summary</h2>
            <p>This is a <strong>production-ready, enterprise-grade SaaS platform</strong> with:</p>
            <ul>
                <li>‚úÖ Complete authentication & billing</li>
                <li>‚úÖ Multi-provider AI integration</li>
                <li>‚úÖ Autonomous agent system</li>
                <li>‚úÖ Workspace management</li>
                <li>‚úÖ Comprehensive usage tracking</li>
                <li>‚úÖ Security best practices</li>
                <li>‚úÖ Scalable architecture</li>
            </ul>
            
            <p>The codebase demonstrates strong engineering practices with clear separation of concerns, type safety, and comprehensive feature coverage. The agent system is particularly sophisticated, implementing the ReAct pattern with a robust tool ecosystem.</p>
        </div>
    </div>
</body>
</html>
